<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Africa Real-Time Sky</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
    * { margin:0; padding:0; box-sizing:border-box; font-family: Arial, sans-serif; }
    body { background:#111; color:white; overflow-x:hidden; min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; transition: background 1s ease; }

    .container { width:100%; max-width:700px; height: 500px; background:#222; border-radius:20px; padding:20px; position:relative; overflow:hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

    /* CELESTIAL BODIES */
    .celestial-body { position:absolute; border-radius:50%; display:none; /* Hidden by default, JS turns them on */ pointer-events: none; }

    .sun { width:80px; height:80px; background: radial-gradient(circle, #ffd700 20%, #ff8c00 100%); box-shadow: 0 0 40px #ff8c00; z-index:1; }
    
    .moon { width:60px; height:60px; background: radial-gradient(circle, #ddd 20%, #777 100%); box-shadow: 0 0 20px #fff; z-index:1; 
            /* The user requested rotation for the moon */
            animation: spinMoon 20s linear infinite; 
    }

    @keyframes spinMoon { 0%{transform: rotate(0deg);} 100%{transform: rotate(360deg);} }

    /* UI ELEMENTS */
    .settings-btn { position:absolute; top:15px; right:15px; background:rgba(0,0,0,0.5); padding:10px 15px; border-radius:10px; cursor:pointer; font-size:14px; z-index:10; color:white; }
    .settings-menu { position:absolute; top:50px; right:15px; width:170px; padding:15px; background:rgba(0,0,0,0.8); border-radius:10px; display:none; z-index:10; }
    .settings-menu.show { display:block; }
    .settings-menu p { margin:10px 0; cursor:pointer; border-bottom:1px solid #555; padding-bottom:5px; }

    .africa-container { position: absolute; bottom: 0; left:0; width:100%; height: 60%; display:flex; align-items:flex-end; justify-content:center; z-index: 2; opacity: 0.4; }
    .africa-img { max-height: 100%; max-width: 100%; }

    .info-box { text-align:center; z-index:5; position:absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); width: 100%; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
    .info-box h1 { font-size:2.5rem; margin-bottom:10px; letter-spacing: 2px; }
    .info-box h2 { font-size:4rem; margin-bottom:5px; font-weight: bold; }
    .info-box h3 { font-size:1.2rem; color: #aaa; }

    @media(max-width:480px){
        .info-box h1{font-size:1.5rem;}
        .info-box h2{font-size:2.5rem;}
        .container { height: 80vh; }
    }
</style>
</head>
<body onclick="allowAudio()">

<div class="container" id="skyContainer">
    <div class="celestial-body sun" id="sun"></div>
    <div class="celestial-body moon" id="moon"></div>

    <div class="settings-btn" onclick="toggleMenu()"><i class="fas fa-cog"></i> Settings</div>
    <div class="settings-menu" id="settingsMenu">
        <p id="toggleAudio"><i class="fas fa-volume-up"></i> Mute/Unmute</p>
        <p onclick="forceMode('day')"><i class="fas fa-sun"></i> Test Day Mode</p>
        <p onclick="forceMode('night')"><i class="fas fa-moon"></i> Test Night Mode</p>
        <p onclick="forceMode('auto')"><i class="fas fa-clock"></i> Auto Mode</p>
    </div>

    <div class="info-box">
        <h2 id="clockText">00:00:00</h2>
        <h1 id="greetingText">Loading...</h1>
        <h3 id="batteryText">Battery: --%</h3>
    </div>

    <div class="africa-container">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/86/Africa_(orthographic_projection).svg" class="africa-img" />
    </div>

    <audio id="audioPlayer" loop></audio>
</div>

<script>
// --- CONFIGURATION ---
let audioAllowed = false;
let audioEnabled = true;
let manualOverride = null; // 'day', 'night', or null (auto)

// --- MAIN ENGINE ---
function updateSystem() {
    const now = new Date();
    const hours = now.getHours();
    const minutes = now.getMinutes();
    const totalMinutes = (hours * 60) + minutes;
    
    updateClock(now);
    updateSky(hours, totalMinutes);
    updateBattery();
}

// 1. CLOCK
function updateClock(dateObj) {
    document.getElementById('clockText').innerText = dateObj.toLocaleTimeString();
}

// 2. SKY ENGINE (The Logic you asked for)
function updateSky(hours, totalMinutes) {
    const sun = document.getElementById('sun');
    const moon = document.getElementById('moon');
    const container = document.getElementById('skyContainer');
    const greeting = document.getElementById('greetingText');
    const audio = document.getElementById('audioPlayer');

    // Define Day duration: 06:00 (360min) to 19:00 (1140min)
    const dayStartMin = 6 * 60; 
    const dayEndMin = 19 * 60;
    
    let isDayTime = (totalMinutes >= dayStartMin && totalMinutes < dayEndMin);
    
    // Check for manual overrides from settings
    if(manualOverride === 'day') isDayTime = true;
    if(manualOverride === 'night') isDayTime = false;

    if (isDayTime) {
        // --- DAY MODE ---
        moon.style.display = 'none';
        sun.style.display = 'block';
        container.style.background = 'linear-gradient(to bottom, #87CEEB, #E0F7FA)'; // Sky Blue
        document.body.style.background = '#87CEEB';
        
        // Calculate Sun Position (0% to 100% across screen)
        // If override is on, simulate noon (50%)
        let percentage = manualOverride ? 0.5 : (totalMinutes - dayStartMin) / (dayEndMin - dayStartMin);
        
        setPosition(sun, percentage);
        
        // Text & Audio
        if(hours < 12) greeting.innerText = "GOOD MORNING AFRICA";
        else greeting.innerText = "GOOD AFTERNOON AFRICA";
        
        if(audio.src.indexOf('morning') === -1 && audioAllowed) {
            audio.src = 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_7c6ac0cb52.mp3'; // Birds
            if(audioEnabled) audio.play().catch(e=>{});
        }

    } else {
        // --- NIGHT MODE (After 7 PM) ---
        sun.style.display = 'none';
        moon.style.display = 'block';
        container.style.background = 'linear-gradient(to bottom, #0f2027, #203a43, #2c5364)'; // Deep Space
        document.body.style.background = '#111';

        // Calculate Moon Position
        // Night is from 19:00 (start) to 06:00 (end next day)
        // Total night minutes = 11 hours * 60 = 660 mins
        let minutesSince7PM = totalMinutes - dayEndMin;
        if (minutesSince7PM < 0) minutesSince7PM += (24 * 60); // Handle post-midnight
        
        // If override is on, simulate midnight (50%)
        let percentage = manualOverride ? 0.5 : minutesSince7PM / (11 * 60); 

        setPosition(moon, percentage);

        // Text & Audio
        if(hours >= 19 && hours < 24) greeting.innerText = "GOOD EVENING AFRICA";
        else greeting.innerText = "GOOD NIGHT AFRICA";

        if(audio.src.indexOf('night') === -1 && audioAllowed) {
            audio.src = 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_1738e9f9d9.mp3'; // Crickets
            if(audioEnabled) audio.play().catch(e=>{});
        }
    }
}

// Helper to calculate X/Y arc
function setPosition(element, percentage) {
    // Left: 0% to 100%
    // Top: Uses Sin wave to make it rise (10%) and set (80%)
    // Math.sin(0) = 0, Math.sin(PI/2) = 1, Math.sin(PI) = 0
    
    // Clamp percentage between 0 and 1
    if(percentage < 0) percentage = 0;
    if(percentage > 1) percentage = 1;

    const leftPos = percentage * 100;
    // The arc: Starts at 80% down, goes up to 10% from top, back to 80% down
    // We modify the PI curve slightly to keep it higher in the sky
    const topPos = 80 - (Math.sin(percentage * Math.PI) * 70); 

    element.style.left = `calc(${leftPos}% - 40px)`; // -40px to center element
    element.style.top = `${topPos}%`;
}

// 3. BATTERY
function updateBattery(){
    if(navigator.getBattery){
        navigator.getBattery().then(bat => {
            document.getElementById('batteryText').innerText = `Battery: ${Math.round(bat.level*100)}% ${bat.charging ? '(Charging)' : ''}`;
        });
    }
}

// --- UTILITIES ---
function allowAudio(){ 
    if(!audioAllowed){
        audioAllowed = true; 
        document.getElementById('audioPlayer').volume = 0.5;
        updateSystem(); // trigger play
    }
}

function toggleMenu(){ 
    document.getElementById('settingsMenu').classList.toggle('show'); 
}

document.getElementById('toggleAudio').addEventListener('click', (e) => {
    e.stopPropagation();
    audioEnabled = !audioEnabled;
    const aud = document.getElementById('audioPlayer');
    audioEnabled ? aud.play() : aud.pause();
    alert(audioEnabled ? "Audio On" : "Audio Off");
});

function forceMode(mode) {
    manualOverride = (mode === 'auto') ? null : mode;
    updateSystem();
    toggleMenu(); // Close menu
}

// Run loop
setInterval(updateSystem, 1000); // Check every second
updateSystem(); // Run immediately

</script>
</body>
</html>
