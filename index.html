<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Africa Real-Time 4-Stage Audio</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
    * { margin:0; padding:0; box-sizing:border-box; font-family: Arial, sans-serif; }
    body { background:#111; color:white; overflow-x:hidden; min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; transition: background 1s ease; }

    .container { width:100%; max-width:700px; height: 500px; background:#222; border-radius:20px; padding:20px; position:relative; overflow:hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

    /* CELESTIAL BODIES */
    .celestial-body { position:absolute; border-radius:50%; display:none; pointer-events: none; }

    .sun { width:80px; height:80px; background: radial-gradient(circle, #ffd700 20%, #ff8c00 100%); box-shadow: 0 0 40px #ff8c00; z-index:1; }
    
    .moon { width:60px; height:60px; background: radial-gradient(circle, #ddd 20%, #777 100%); box-shadow: 0 0 20px #fff; z-index:1; 
            animation: spinMoon 20s linear infinite; }

    @keyframes spinMoon { 0%{transform: rotate(0deg);} 100%{transform: rotate(360deg);} }

    /* UI ELEMENTS */
    .settings-btn { position:absolute; top:15px; right:15px; background:rgba(0,0,0,0.5); padding:10px 15px; border-radius:10px; cursor:pointer; font-size:14px; z-index:10; color:white; }
    .settings-menu { position:absolute; top:50px; right:15px; width:200px; padding:15px; background:rgba(0,0,0,0.8); border-radius:10px; display:none; z-index:10; }
    .settings-menu.show { display:block; }
    .settings-menu p { margin:10px 0; cursor:pointer; border-bottom:1px solid #555; padding-bottom:5px; font-size: 13px; }

    .africa-container { position: absolute; bottom: 0; left:0; width:100%; height: 60%; display:flex; align-items:flex-end; justify-content:center; z-index: 2; opacity: 0.4; }
    .africa-img { max-height: 100%; max-width: 100%; }

    .info-box { text-align:center; z-index:5; position:absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); width: 100%; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
    .info-box h1 { font-size:2.5rem; margin-bottom:10px; letter-spacing: 2px; }
    .info-box h2 { font-size:4rem; margin-bottom:5px; font-weight: bold; }
    .info-box h3 { font-size:1.2rem; color: #aaa; }

    @media(max-width:480px){
        .info-box h1{font-size:1.5rem;}
        .info-box h2{font-size:2.5rem;}
        .container { height: 80vh; }
    }
</style>
</head>
<body onclick="allowAudio()">

<div class="container" id="skyContainer">
    <div class="celestial-body sun" id="sun"></div>
    <div class="celestial-body moon" id="moon"></div>

    <div class="settings-btn" onclick="toggleMenu()"><i class="fas fa-cog"></i> Settings</div>
    <div class="settings-menu" id="settingsMenu">
        <p id="toggleAudio"><i class="fas fa-volume-up"></i> Mute/Unmute</p>
        <p onclick="forceMode(9)"><i class="fas fa-sun"></i> Test Morning (9 AM)</p>
        <p onclick="forceMode(14)"><i class="fas fa-cloud-sun"></i> Test Afternoon (2 PM)</p>
        <p onclick="forceMode(18)"><i class="fas fa-cloud-moon"></i> Test Evening (6 PM)</p>
        <p onclick="forceMode(22)"><i class="fas fa-moon"></i> Test Night (10 PM)</p>
        <p onclick="forceMode('auto')"><i class="fas fa-clock"></i> Auto Mode</p>
    </div>

    <div class="info-box">
        <h2 id="clockText">00:00:00</h2>
        <h1 id="greetingText">Loading...</h1>
        <h3 id="batteryText">Battery: --%</h3>
    </div>

    <div class="africa-container">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/86/Africa_(orthographic_projection).svg" class="africa-img" />
    </div>

    <audio id="audioPlayer" loop></audio>
</div>

<script>
// --- CONFIGURATION ---
let audioAllowed = false;
let audioEnabled = true;
let manualHour = null; // Used for testing specific times

// --- MAIN ENGINE ---
function updateSystem() {
    const now = new Date();
    // Use manualHour if set (for testing), otherwise real time
    const hours = (manualHour !== null) ? manualHour : now.getHours();
    const minutes = now.getMinutes();
    
    // We calculate "Total Minutes" to animate smooth movement
    // If manualHour is set, we assume minutes are 30 (half past)
    const currentTotalMinutes = (manualHour !== null) ? (manualHour * 60) + 30 : (hours * 60) + minutes;
    
    updateClock(now);
    updateSky(hours, currentTotalMinutes);
    updateAudio(hours); // NEW: Separate Audio Function
    updateBattery();
}

// 1. CLOCK
function updateClock(dateObj) {
    if(manualHour !== null) {
        document.getElementById('clockText').innerText = `Test: ${manualHour}:30`;
        document.getElementById('clockText').style.color = 'orange';
    } else {
        document.getElementById('clockText').innerText = dateObj.toLocaleTimeString();
        document.getElementById('clockText').style.color = 'white';
    }
}

// 2. AUDIO ENGINE (4 STAGES)
function updateAudio(h) {
    const audio = document.getElementById('audioPlayer');
    const greeting = document.getElementById('greetingText');
    let targetSrc = '';
    let targetGreeting = '';

    // LOGIC: Define the 4 blocks
    if (h >= 5 && h < 12) {
        // MORNING (5am - 11:59am)
        targetGreeting = 'GOOD MORNING AFRICA';
        // Use local file 'audio/morning.mp3' OR online fallback
        targetSrc = 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_7c6ac0cb52.mp3'; // Birds
    } 
    else if (h >= 12 && h < 17) {
        // AFTERNOON (12pm - 4:59pm)
        targetGreeting = 'GOOD AFTERNOON AFRICA';
        // Use local file 'audio/afternoon.mp3' OR online fallback
        targetSrc = 'audio/afternoon.mp3'; // Windy/Nature
    } 
    else if (h >= 17 && h < 20) {
        // EVENING (5pm - 7:59pm)
        targetGreeting = 'GOOD EVENING AFRICA';
        // Use local file 'audio/evening.mp3' OR online fallback
        targetSrc = 'https://cdn.pixabay.com/download/audio/2022/02/07/audio_86e0d7fcb1.mp3'; // Soft Crickets
    } 
    else {
        // NIGHT (8pm - 4:59am)
        targetGreeting = 'GOOD NIGHT AFRICA';
        // Use local file 'audio/night.mp3' OR online fallback
        targetSrc = 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_1738e9f9d9.mp3'; // Deep Night
    }

    greeting.innerText = targetGreeting;

    // Only switch the song if the URL is different to prevent skipping
    if (audioAllowed && audioEnabled) {
        // We check if the current source matches the target. 
        // Note: audio.src gives full URL, so we check if it includes the filename or unique ID
        if (audio.src !== targetSrc) {
            audio.src = targetSrc;
            audio.play().catch(e => console.log("Audio waiting for interaction"));
        }
    }
}

// 3. SKY VISUALS (Sun/Moon Logic)
function updateSky(hours, totalMinutes) {
    const sun = document.getElementById('sun');
    const moon = document.getElementById('moon');
    const container = document.getElementById('skyContainer');

    // Day is 06:00 to 19:00 (7 PM)
    const dayStartMin = 6 * 60; 
    const dayEndMin = 19 * 60;
    
    let isDayTime = (totalMinutes >= dayStartMin && totalMinutes < dayEndMin);

    if (isDayTime) {
        // DAY VISUALS
        moon.style.display = 'none';
        sun.style.display = 'block';
        
        // Change Background based on Morning vs Afternoon for better effect
        if(hours < 16) container.style.background = 'linear-gradient(to bottom, #87CEEB, #E0F7FA)'; // Blue Sky
        else container.style.background = 'linear-gradient(to bottom, #ff9966, #ff5e62)'; // Sunset Orange (Late afternoon)

        let percentage = (totalMinutes - dayStartMin) / (dayEndMin - dayStartMin);
        setPosition(sun, percentage);
    } else {
        // NIGHT VISUALS
        sun.style.display = 'none';
        moon.style.display = 'block';
        container.style.background = 'linear-gradient(to bottom, #0f2027, #203a43, #2c5364)'; // Deep Space

        let minutesSince7PM = totalMinutes - dayEndMin;
        if (minutesSince7PM < 0) minutesSince7PM += (24 * 60); 
        let percentage = minutesSince7PM / (11 * 60); 

        setPosition(moon, percentage);
    }
}

function setPosition(element, percentage) {
    if(percentage < 0) percentage = 0;
    if(percentage > 1) percentage = 1;
    const leftPos = percentage * 100;
    const topPos = 80 - (Math.sin(percentage * Math.PI) * 70); 
    element.style.left = `calc(${leftPos}% - 40px)`;
    element.style.top = `${topPos}%`;
}

// 4. BATTERY
function updateBattery(){
    if(navigator.getBattery){
        navigator.getBattery().then(bat => {
            document.getElementById('batteryText').innerText = `Battery: ${Math.round(bat.level*100)}% ${bat.charging ? '(Charging)' : ''}`;
        });
    }
}

// --- UTILITIES ---
function allowAudio(){ 
    if(!audioAllowed){
        audioAllowed = true; 
        document.getElementById('audioPlayer').volume = 0.5;
        updateSystem(); 
    }
}
function toggleMenu(){ document.getElementById('settingsMenu').classList.toggle('show'); }

document.getElementById('toggleAudio').addEventListener('click', (e) => {
    e.stopPropagation();
    audioEnabled = !audioEnabled;
    const aud = document.getElementById('audioPlayer');
    audioEnabled ? aud.play() : aud.pause();
});

function forceMode(h) {
    manualHour = (h === 'auto') ? null : h;
    updateSystem();
    toggleMenu(); 
}

setInterval(updateSystem, 1000); 
updateSystem(); 
</script>
</body>
</html>
